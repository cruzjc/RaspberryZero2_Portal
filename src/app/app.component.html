<div class="terminal-container">
  <!-- Retro Header -->
  <header class="terminal-header">
    <div class="brand-line">
      <span class="prompt">></span> SYSTEM.ROOT <span class="blink">_</span>
    </div>
    <div class="header-right">
      <span class="status-indicator" [class.active]="sessionActive">
        [{{ sessionActive ? "LINK_ACTIVE" : "STANDBY" }}]
      </span>
      <span class="datetime">{{ currentDate | date: "HH:mm:ss" }}</span>
    </div>
  </header>

  <!-- Main Content Area -->
  <main class="terminal-body">
    <!-- View Switcher / Menu -->
    <nav class="terminal-nav">
      <button class="term-btn" [class.active]="currentView === 'dashboard'" (click)="currentView = 'dashboard'">
        [ DASHBOARD ]
      </button>
      <button class="term-btn" [class.active]="currentView === 'settings'" (click)="toggleSettings()">
        [ CONFIG ]
      </button>
      <button class="term-btn" [class.active]="currentView === 'services'" (click)="currentView = 'services'">
        [ SERVICES ]
      </button>
      <div class="nav-spacer"></div>
      <button class="term-btn danger" (click)="endCall()" *ngIf="chatOpen">
        [ END_CHAT ]
      </button>
      <button class="term-btn danger" (click)="endVoice()" *ngIf="voiceActive">
        [ END_VOICE ]
      </button>
      <button class="term-btn primary" (click)="startCall()" *ngIf="!chatOpen && !voiceActive">
        [ ESTABLISH_LINK ]
      </button>
      <button class="term-btn voice" (click)="startVoice()" *ngIf="!chatOpen && !voiceActive">
        [ VOICE_LINK ]
      </button>
    </nav>

    <!-- DASHBOARD VIEW -->
    <div class="view-panel" *ngIf="currentView === 'dashboard'">
      <!-- System Status Line -->
      <div class="status-line">
        <span class="label">CPU:</span> <span class="val">12%</span>
        <span class="sep">|</span>
        <span class="label">MEM:</span> <span class="val">235M</span>
        <span class="sep">|</span>
        <span class="label">TMP:</span> <span class="val">42C</span>
      </div>

      <!-- News Feed (Simplified) -->
      <div class="terminal-section">
        <div class="section-title">-- NEWS_FEED --</div>
        <app-news-widget></app-news-widget>
      </div>

      <!-- Trading Status -->
      <div class="terminal-section">
        <div class="section-title">-- TRADING_STATUS --</div>
        <app-trading-status></app-trading-status>
      </div>

      <!-- Notes / Resources -->
      <div class="terminal-section">
        <div class="section-title">-- DATA_LOGS --</div>
        <div class="input-line">
          <span class="prompt">></span>
          <input type="text" placeholder="Add entry..." (keyup.enter)="addResource()" class="term-input">
          <button (click)="addResource()" class="term-btn-sm">[ADD]</button>
        </div>
        <ul class="log-list">
          <li *ngFor="let r of resources">
            <span class="log-id">{{ r.createdAt | date:'HH:mm' }}</span>
            <span class="log-content">{{ r.content }}</span>
            <button (click)="deleteResource(r)" class="term-btn-xs">[x]</button>
          </li>
        </ul>
      </div>
    </div>

    <!-- SETTINGS VIEW -->
    <div class="view-panel" *ngIf="currentView === 'settings'">
      <div class="terminal-section">
        <div class="section-title">-- SYSTEM_CONFIG --</div>

        <div class="config-group">
          <h3>// ADMIN_CONTROLS</h3>
          <app-admin-settings></app-admin-settings>
        </div>

        <div class="action-row">
          <button class="term-btn" (click)="updatePortal()">[ SYS_UPDATE ]</button>
          <button class="term-btn" (click)="deployPortal()">[ RE-DEPLOY ]</button>
        </div>
      </div>
    </div>

    <!-- SERVICES VIEW -->
    <div class="view-panel" *ngIf="currentView === 'services'">
      <app-services-management></app-services-management>
    </div>

    <!-- GitHub Contribution Chart -->
    <div class="github-activity">
      <div class="section-title">-- GITHUB_ACTIVITY --</div>
      <div class="contribution-chart">
        <img src="https://ghchart.rshah.org/00ff41/cruzjc" alt="GitHub Contribution Chart" class="waffle-chart"
          loading="lazy" />
      </div>
      <div class="github-link">
        <a href="https://github.com/cruzjc" target="_blank" rel="noopener">github.com/cruzjc</a>
      </div>
    </div>

    <!-- Feature Descriptions -->
    <div class="feature-info">
      <div class="info-line">
        <span class="info-label">[ESTABLISH_LINK]</span>
        <span class="info-desc">AI Assistant powered by Inworld API. Contact point for system queries and in-character
          assistance.</span>
      </div>
      <div class="info-line">
        <span class="info-label">[AI BRIEFING]</span>
        <span class="info-desc">News summarization via Gemini (gemini-2.0-flash). TTS narration via Inworld API.</span>
      </div>
    </div>
  </main>

  <!-- Chat Assistant Modal -->
  <app-chat-assistant *ngIf="chatOpen" (close)="endCall()"></app-chat-assistant>

  <!-- Voice Chat Modal -->
  <app-voice-chat *ngIf="voiceActive" (close)="endVoice()"></app-voice-chat>
</div>